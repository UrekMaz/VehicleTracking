<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vehicle Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    /* --- Your existing CSS from previous code --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; display: flex; height: 100vh; overflow: hidden; background: #f3f4f6; }
    .sidebar { width: 380px; background: white; box-shadow: 2px 0 8px rgba(0,0,0,0.1); display: flex; flex-direction: column; z-index: 1000; }
    .header { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; padding: 24px; }
    .header h1 { font-size: 24px; font-weight: bold; margin-bottom: 16px; }
    .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
    .stat-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 8px; padding: 12px; }
    .stat-label { font-size: 11px; color: #bfdbfe; margin-bottom: 4px; }
    .stat-value { font-size: 24px; font-weight: bold; }
    .alerts { display: flex; gap: 8px; flex-wrap: wrap; }
    .alert-badge { background: rgba(239, 68, 68, 0.2); backdrop-filter: blur(10px); border-radius: 6px; padding: 6px 12px; font-size: 13px; }
    .alert-badge.warning { background: rgba(245, 158, 11, 0.2); }
    .vehicle-list { flex: 1; overflow-y: auto; padding: 16px; }
    .vehicle-card { background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
    .vehicle-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-1px); }
    .vehicle-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .vehicle-info { display: flex; align-items: center; gap: 8px; }
    .vehicle-icon { width: 40px; height: 40px; background: #dbeafe; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #2563eb; }
    .vehicle-id { font-weight: 600; font-size: 15px; color: #111827; }
    .status-badge { font-size: 10px; font-weight: 600; padding: 4px 8px; border-radius: 12px; border: 1px solid; }
    .status-active { background: #dcfce7; color: #166534; border-color: #bbf7d0; }
    .status-warning { background: #fef3c7; color: #92400e; border-color: #fde68a; }
    .status-critical { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
    .vehicle-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .stat-item { display: flex; align-items: center; gap: 8px; }
    .stat-icon { width: 16px; height: 16px; color: #6b7280; }
    .stat-content { flex: 1; }
    .stat-content label { display: block; font-size: 11px; color: #6b7280; margin-bottom: 2px; }
    .stat-content value { display: block; font-size: 14px; font-weight: 600; color: #111827; }
    .timestamp { font-size: 11px; color: #9ca3af; margin-top: 12px; text-align: right; }
    .map-container { flex: 1; position: relative; }
    #map { width: 100%; height: 100%; }
    .loading { display: flex; align-items: center; justify-content: center; padding: 48px; }
    .spinner { width: 32px; height: 32px; border: 3px solid #e5e7eb; border-top-color: #2563eb; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .map-controls { position: absolute; bottom: 24px; right: 24px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); overflow: hidden; z-index: 1000; }
    .map-controls button { display: block; width: 40px; height: 40px; border: none; background: white; cursor: pointer; font-size: 20px; font-weight: bold; color: #374151; transition: background 0.2s; }
    .map-controls button:hover { background: #f3f4f6; }
    .map-controls button:first-child { border-bottom: 1px solid #e5e7eb; }
    .live-indicator { position: absolute; top: 24px; right: 24px; background: white; padding: 12px 16px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 8px; z-index: 1000; }
    .live-dot { width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .live-text { font-size: 14px; font-weight: 500; color: #374151; }
    /* New UI enhancements */
    .guide-panel { background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; padding:10px; margin-bottom:12px; font-size:12px; }
    .guide-step { display:flex; align-items:center; gap:6px; margin-bottom:6px; }
    .guide-step:last-child { margin-bottom:0; }
    .step-indicator { width:16px; height:16px; border-radius:50%; background:#cbd5e1; font-size:10px; font-weight:600; display:flex; align-items:center; justify-content:center; color:#334155; }
    .step-active .step-indicator { background:#2563eb; color:white; }
    .step-done .step-indicator { background:#10b981; color:white; }
    .route-buttons button { position:relative; }
    .route-buttons button:hover { filter:brightness(1.08); box-shadow:0 2px 6px rgba(0,0,0,0.12); }
    .route-buttons button:active { transform:scale(0.97); }
    .route-buttons button.active-mode { outline:2px solid #fbbf24; }
    .live-toggle { margin-top:8px; padding:6px 10px; background:#0d9488; color:white; border:none; border-radius:6px; cursor:pointer; font-size:12px; }
    .live-toggle.off { background:#64748b; }
    .fit-btn { padding:6px 10px; background:#9333ea; color:white; border:none; border-radius:6px; cursor:pointer; font-size:12px; margin-top:8px; }
    .fit-btn:hover { filter:brightness(1.1); }
    .standard-route-style { stroke-dasharray:8 6; }
    .optimized-route-style { filter:drop-shadow(0 0 4px rgba(16,185,129,0.5)); }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="header">
      <h1>Vehicle Tracker</h1>
      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">Total Vehicles</div>
          <div class="stat-value" id="totalVehicles">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Active</div>
          <div class="stat-value" id="activeVehicles">0</div>
        </div>
      </div>
      <div class="alerts" id="alerts"></div>
    </div>

    <!-- Vehicle list -->
    <div class="vehicle-list" id="vehicleList">
      <div class="loading">
        <div class="spinner"></div>
      </div>
    </div>

    <!-- Route controls -->
    <div style="padding: 16px; border-top: 1px solid #e5e7eb;">
      <div class="guide-panel" id="guidePanel">
        <div class="guide-step" id="step-source"><div class="step-indicator">1</div><div>Set <strong>Source</strong> (click map)</div></div>
        <div class="guide-step" id="step-destination"><div class="step-indicator">2</div><div>Set <strong>Destination</strong> (click map)</div></div>
        <div class="guide-step" id="step-waypoints"><div class="step-indicator">3</div><div>Add optional <strong>Waypoints</strong></div></div>
        <div class="guide-step" id="step-standard"><div class="step-indicator">4</div><div>Draw <strong>Standard Route</strong></div></div>
        <div class="guide-step" id="step-optimized"><div class="step-indicator">5</div><div>Generate <strong>Optimized Route</strong></div></div>
      </div>
      <label for="vehicleSelect" style="font-weight:600; margin-bottom:4px; display:block;">Track Vehicle:</label>
      <select id="vehicleSelect" style="width:100%; padding:8px; border-radius:6px; border:1px solid #d1d5db; margin-bottom:12px;">
        <option value="">-- Select Vehicle --</option>
      </select>
      <div class="route-buttons" style="display:grid; gap:8px; margin-bottom:12px;">
        <button id="setSourceBtn" onclick="activateSetMode('source')" style="padding:8px; background:#1d4ed8; color:white; border:none; border-radius:6px; cursor:pointer;">1. Set Source</button>
        <button id="setDestBtn" onclick="activateSetMode('destination')" style="padding:8px; background:#1d4ed8; color:white; border:none; border-radius:6px; cursor:pointer;" disabled>2. Set Destination</button>
        <button id="addWaypointBtn" onclick="activateSetMode('waypoint')" style="padding:8px; background:#2563eb; color:white; border:none; border-radius:6px; cursor:pointer;" disabled>3. Add Waypoint</button>
        <button id="drawStandardBtn" onclick="requestStandardRoute()" style="padding:8px; background:#374151; color:white; border:none; border-radius:6px; cursor:pointer;" disabled>4. Standard Route</button>
        <button id="optimizeBtn" onclick="optimizeRoute()" style="padding:8px; background:#10b981; color:white; border:none; border-radius:6px; cursor:pointer;" disabled>5. Optimize Route</button>
        <button onclick="clearRoute()" style="padding:8px; background:#dc2626; color:white; border:none; border-radius:6px; cursor:pointer;">Clear Route</button>
        <button class="fit-btn" onclick="fitVehicles()">Fit Vehicles</button>
        <button id="liveToggle" class="live-toggle" onclick="toggleLiveUpdates()">Live Updates: ON</button>
      </div>
      <div style="background:#f3f4f6; padding:8px; border-radius:6px; font-size:12px; line-height:1.4;">
        <strong>Route Status:</strong>
        <div id="routeStatus">No route defined.</div>
        <div style="margin-top:6px;">
          <span style="display:inline-block; width:10px; height:10px; background:#1d4ed8; border-radius:50%;"></span> Source
          <span style="display:inline-block; width:10px; height:10px; background:#ef4444; border-radius:50%; margin-left:12px;"></span> Destination
          <span style="display:inline-block; width:10px; height:10px; background:#fb923c; border-radius:50%; margin-left:12px;"></span> Waypoint
        </div>
      </div>
    </div>
  </div>

  <div class="map-container">
    <div id="map"></div>
    <div class="live-indicator">
      <div class="live-dot"></div>
      <span class="live-text">Live Tracking</span>
    </div>
    <div class="map-controls">
      <button onclick="zoomIn()">+</button>
      <button onclick="zoomOut()">âˆ’</button>
    </div>
  </div>

  <script>
    const API_URL = "https://dppzqfg20e.execute-api.ap-south-1.amazonaws.com/prod/vehicles";

    let map;
    let markers = {};
    let vehicles = [];
    let routePolyline = null;
    let sourcePoint = null;
    let destinationPoint = null;
    let waypointPoints = [];
    let setMode = null; // 'source' | 'destination' | 'waypoint' | null
    let tempMarkers = []; // markers for source/dest/waypoints
    let selectedVehicleId = '';
    const OSRM_BASE = 'https://router.project-osrm.org';
    let liveEnabled = true;
    let refreshInterval = 10000;
    let intervalHandle = null;
    let standardDetour = null;
    let lastStandardDistance = null;
    let lastOptimizedDistance = null;

    const destinations = [
      { lat: 12.975, lon: 77.591 },
      { lat: 12.972, lon: 77.595 },
      { lat: 12.969, lon: 77.600 }
    ];

    // Initialize map
    function initMap() {
      map = L.map('map').setView([12.9716, 77.5946], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors',
        maxZoom: 19
      }).addTo(map);
    }

    // Vehicle icon
    function createVehicleIcon(status) {
      const colors = { active:'#10b981', warning:'#f59e0b', critical:'#ef4444' };
      const color = colors[status] || colors.active;
      return L.divIcon({
        className: 'custom-marker',
        html: `<div style="position: relative;"><div style="background:${color};width:32px;height:32px;border-radius:50%;border:3px solid white;display:flex;align-items:center;justify-content:center;"></div></div>`,
        iconSize:[32,32], iconAnchor:[16,32], popupAnchor:[0,-32]
      });
    }

    function getStatus(vehicle){
      if(vehicle.fuel_percent<20) return 'critical';
      if(vehicle.fuel_percent<40 || vehicle.speed_kmh>80) return 'warning';
      return 'active';
    }

    // Update markers
    function updateMarkers(){
      vehicles.forEach(v=>{
        const status = getStatus(v);
        const pos=[v.latitude,v.longitude];
        if(markers[v.vehicle_id]){
          markers[v.vehicle_id].setLatLng(pos);
          markers[v.vehicle_id].setIcon(createVehicleIcon(status));
        } else {
          const marker=L.marker(pos,{icon:createVehicleIcon(status)}).addTo(map);
          markers[v.vehicle_id]=marker;
        }
      });
    }

    // Vehicle list
    function updateVehicleList(){
      const container=document.getElementById('vehicleList');
      if(vehicles.length===0){ container.innerHTML='<div class="empty-state">No vehicles found</div>'; return; }
      container.innerHTML=vehicles.map(v=>`
        <div class="vehicle-card" onclick="locateVehicle('${v.vehicle_id}')">
          <div class="vehicle-header">
            <div class="vehicle-info"><div class="vehicle-id">${v.vehicle_id}</div></div>
            <span class="status-badge status-${getStatus(v)}">${getStatus(v).toUpperCase()}</span>
          </div>
          <div class="timestamp">Updated: ${new Date(v.timestamp).toLocaleTimeString()}</div>
        </div>`).join('');
    }

    function updateStats(){
      const stats = {
        total: vehicles.length,
        active: vehicles.filter(v=>getStatus(v)==='active').length,
        warning: vehicles.filter(v=>getStatus(v)==='warning').length,
        critical: vehicles.filter(v=>getStatus(v)==='critical').length
      };
      document.getElementById('totalVehicles').textContent = stats.total;
      document.getElementById('activeVehicles').textContent = stats.active;
    }

    function updateVehicleSelect() {
      const select = document.getElementById('vehicleSelect');
      select.innerHTML = '<option value="">-- Select Vehicle --</option>';
      vehicles.forEach(v=>{
        const option=document.createElement('option');
        option.value=v.vehicle_id; option.textContent=v.vehicle_id;
        select.appendChild(option);
      });
    }

    async function fetchVehicles(){
      try{
        const res = await fetch(API_URL);
        if(!res.ok) throw new Error('Failed to fetch vehicles');
        const data = await res.json();
        const vehicleMap = new Map();
        (data.items || []).forEach(v=>{
          const existing = vehicleMap.get(v.vehicle_id);
          if(!existing || (v.timestamp && v.timestamp>existing.timestamp)) vehicleMap.set(v.vehicle_id,v);
        });
        vehicles=Array.from(vehicleMap.values());
        updateVehicleList(); updateStats(); updateMarkers(); updateVehicleSelect();
      } catch(e){
        console.error(e);
      }
    }

    function locateVehicle(vehicleId){
      const v=vehicles.find(v=>v.vehicle_id===vehicleId);
      if(v && markers[vehicleId]){
        map.setView([v.latitude,v.longitude],15);
      }
    }

    function zoomIn(){map.zoomIn();}
    function zoomOut(){map.zoomOut();}

    // --- Route functions ---
    function drawRoute(coords,color,optimized=false){
      if(routePolyline) map.removeLayer(routePolyline);
      const style = { color, weight: optimized?7:5, opacity:0.85 };
      if(!optimized) style.dashArray = '8 6';
      routePolyline = L.polyline(coords, style).addTo(map);
      map.fitBounds(routePolyline.getBounds(),{padding:[50,50]});
    }

    function updateGuideSteps(){
      const setState = (id,state)=>{
        const el=document.getElementById(id);
        el.classList.remove('step-active','step-done');
        if(state==='active') el.classList.add('step-active');
        if(state==='done') el.classList.add('step-done');
      };
      setState('step-source', sourcePoint?'done': (setMode==='source'?'active':null));
      setState('step-destination', destinationPoint?'done': (setMode==='destination'?'active':null));
      setState('step-waypoints', waypointPoints.length>0?'done': (setMode==='waypoint'?'active':null));
      setState('step-standard', routePolyline && !routePolyline.options.dashArray? 'done': null);
      setState('step-optimized', routePolyline && !routePolyline.options.dashArray && routePolyline.options.weight===7? 'done': null);
    }

    function fitVehicles(){
      const ids = Object.keys(markers);
      if(!ids.length) return;
      const group = L.featureGroup(ids.map(id=>markers[id]));
      map.fitBounds(group.getBounds(),{padding:[40,40]});
    }

    function activateSetMode(mode){
      setMode = mode;
      const statusMap = { source:'Click on map to set SOURCE', destination:'Click on map to set DESTINATION', waypoint:'Click to add WAYPOINT' };
      document.getElementById('routeStatus').textContent = statusMap[mode] || 'No route defined.';
      highlightActiveButton();
      updateGuideSteps();
    }

    function highlightActiveButton(){
      ['setSourceBtn','setDestBtn','addWaypointBtn'].forEach(id=>document.getElementById(id).classList.remove('active-mode'));
      if(setMode==='source') document.getElementById('setSourceBtn').classList.add('active-mode');
      if(setMode==='destination') document.getElementById('setDestBtn').classList.add('active-mode');
      if(setMode==='waypoint') document.getElementById('addWaypointBtn').classList.add('active-mode');
    }

    function addTempMarker(lat, lon, type){
      const colorMap = { source:'#1d4ed8', destination:'#ef4444', waypoint:'#fb923c' };
      const marker = L.circleMarker([lat, lon], { radius:8, color:colorMap[type], fillColor:colorMap[type], fillOpacity:0.9 });
      marker.addTo(map);
      tempMarkers.push(marker);
    }

    function clearRoute(){
      if(routePolyline) { map.removeLayer(routePolyline); routePolyline=null; }
      tempMarkers.forEach(m=>map.removeLayer(m));
      tempMarkers=[]; sourcePoint=null; destinationPoint=null; waypointPoints=[]; setMode=null;
      document.getElementById('routeStatus').textContent='Route cleared.';
      enableDisableButtons();
      updateGuideSteps();
    }

    function requestStandardRoute(){
      if(!sourcePoint || !destinationPoint){
        return alert('Set both source and destination first.');
      }
      // Build original order, inject artificial detour if no waypoints to ensure longer path
      let coords = [sourcePoint, ...waypointPoints, destinationPoint];
      if(waypointPoints.length===0){
        // Create perpendicular offset detour
        const sx = sourcePoint[1], sy = sourcePoint[0];
        const dx = destinationPoint[1], dy = destinationPoint[0];
        const midLat = (sy+dy)/2; const midLon=(sx+dx)/2;
        const vx = dx - sx; const vy = dy - sy;
        const length = Math.max(Math.sqrt(vx*vx+vy*vy), 0.0001);
        const scale = 0.01; // detour magnitude
        // Perpendicular vector
        const px = -vy/length * scale; const py = vx/length * scale;
        standardDetour = [midLat+py, midLon+px];
        addTempMarker(standardDetour[0], standardDetour[1], 'waypoint');
        coords = [sourcePoint, standardDetour, destinationPoint];
      } else {
        standardDetour = null;
      }
      requestOsrmRoute(coords, 'blue', false);
    }

    function optimizeRoute(){
      if(!sourcePoint || !destinationPoint){
        return alert('Set source and destination first.');
      }
      // Exclude artificial detour from optimization
      const effectiveWaypoints = waypointPoints.filter(p=>!standardDetour || (p[0]!==standardDetour[0] || p[1]!==standardDetour[1]));
      const remaining = [...effectiveWaypoints];
      let current = sourcePoint;
      const ordered = [];
      while(remaining.length){
        remaining.sort((a,b)=>{
          const da = (a[0]-current[0])**2 + (a[1]-current[1])**2;
          const db = (b[0]-current[0])**2 + (b[1]-current[1])**2;
          return da-db;
        });
        const next = remaining.shift();
        ordered.push(next);
        current = next;
      }
      let path = [sourcePoint, ...ordered, destinationPoint];
      path = twoOpt(path);
      requestOsrmRoute(path, '#059669', true);
      document.getElementById('routeStatus').textContent='Optimized route drawn.';
    }

    function twoOpt(points){
      // Keep endpoints fixed
      if(points.length <= 3) return points;
      let improved = true;
      const dist = (a,b)=> (a[0]-b[0])**2 + (a[1]-b[1])**2; // squared dist ok for comparison
      while(improved){
        improved = false;
        for(let i=1;i<points.length-2;i++){
          for(let k=i+1;k<points.length-1;k++){
            const A=points[i-1], B=points[i], C=points[k], D=points[k+1];
            const currentDist = dist(A,B)+dist(C,D);
            const newDist = dist(A,C)+dist(B,D);
            if(newDist < currentDist){
              const reversed = points.slice(i,k+1).reverse();
              points = [...points.slice(0,i), ...reversed, ...points.slice(k+1)];
              improved = true;
            }
          }
        }
      }
      return points;
    }

    async function requestOsrmRoute(latLonPairs, color, optimized){
      try {
        const coordsStr = latLonPairs.map(p=>`${p[1]},${p[0]}`).join(';');
        document.getElementById('routeStatus').textContent='Routing...';
        const url = `${OSRM_BASE}/route/v1/driving/${coordsStr}?overview=full&geometries=geojson`;
        const res = await fetch(url);
        if(!res.ok) throw new Error('OSRM request failed');
        const data = await res.json();
        if(!data.routes || !data.routes.length) throw new Error('No route found');
        const routeCoords = data.routes[0].geometry.coordinates.map(c=>[c[1], c[0]]);
        drawRoute(routeCoords, color, optimized);
        const distKm = (data.routes[0].distance/1000).toFixed(2);
        const durMin = (data.routes[0].duration/60).toFixed(1);
        if(!optimized){
          lastStandardDistance = parseFloat(distKm);
        } else {
          lastOptimizedDistance = parseFloat(distKm);
        }
        let improvementMsg='';
        if(lastStandardDistance!==null && lastOptimizedDistance!==null){
          const diff = lastStandardDistance - lastOptimizedDistance;
          const pct = ((diff/lastStandardDistance)*100).toFixed(1);
          improvementMsg = ` | Saved: ${diff.toFixed(2)} km (${pct}%)`;
        }
        document.getElementById('routeStatus').textContent=`Route: ${distKm} km, ${durMin} min (${optimized?'Optimized':'Standard'})${improvementMsg}`;
        enableDisableButtons();
        updateGuideSteps();
      } catch(e){
        console.error(e);
        document.getElementById('routeStatus').textContent='Routing error.';
        alert('Routing failed: '+e.message);
      }
    }

    function enableDisableButtons(){
      document.getElementById('setDestBtn').disabled = !sourcePoint;
      document.getElementById('addWaypointBtn').disabled = !sourcePoint || !destinationPoint;
      document.getElementById('drawStandardBtn').disabled = !sourcePoint || !destinationPoint;
      document.getElementById('optimizeBtn').disabled = !sourcePoint || !destinationPoint;
    }

    function toggleLiveUpdates(){
      liveEnabled = !liveEnabled;
      const btn = document.getElementById('liveToggle');
      btn.textContent = `Live Updates: ${liveEnabled? 'ON':'OFF'}`;
      btn.classList.toggle('off', !liveEnabled);
      if(liveEnabled){ startLiveInterval(); } else { clearInterval(intervalHandle); intervalHandle=null; }
    }

    function startLiveInterval(){
      if(intervalHandle) clearInterval(intervalHandle);
      intervalHandle = setInterval(()=>{ if(liveEnabled && !setMode) fetchVehicles(); }, refreshInterval);
    }

    // Initialize
    initMap();
    fetchVehicles();
    startLiveInterval();
    map.on('click', e => {
      if(!setMode) return;
      const { lat, lng } = e.latlng;
      if(setMode==='source') { sourcePoint=[lat,lng]; addTempMarker(lat,lng,'source'); }
      else if(setMode==='destination') { destinationPoint=[lat,lng]; addTempMarker(lat,lng,'destination'); }
      else if(setMode==='waypoint') { waypointPoints.push([lat,lng]); addTempMarker(lat,lng,'waypoint'); }
      setMode=null;
      document.getElementById('routeStatus').textContent='Points ready. Draw or optimize route.';
      enableDisableButtons();
      highlightActiveButton();
      updateGuideSteps();
    });
    document.getElementById('vehicleSelect').addEventListener('change', e => { selectedVehicleId = e.target.value; });
    enableDisableButtons();
    updateGuideSteps();

  </script>
</body>
</html>
